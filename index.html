<!doctype html>

<html>
  <head>
  <meta charset="utf8">
  <style>
    .comment-level-1 {
      border: solid 1px red;
    }
    .comment-level-2 {
      border: solid 1px green;
      margin-left: 20px;
    }
  </style>
  </head>
  <body>

    Hello world
    <script src="https://cdn.steemjs.com/lib/latest/steem.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
    <script>
    let parent = 'sambillingham';
    let parentPermlink = '20180116t130531377z-post';

    steem.api.setOptions({ url: 'wss://rpc.buildteam.io' });


    // steem.api.getContentReplies(parent, parentPermlink, function (err, result) {
    //   console.log(err, result);
    // });

    steem.api.getState(`/photofeed/@${parent}/${parentPermlink}`, function(err, result) {
        console.log(err, result);

        let resultsArray = [];

        for ( post in result.content ){

          var html = result.content[post].body

          resultsArray.push({
              id: result.content[post].id,
              title: result.content[post].title,
              author: result.content[post].author,
              body: html,
              permlink: result.content[post].permlink,
              depth: result.content[post].depth,
              root_comment: result.content[post].root_comment,
              parent_permlink: result.content[post].parent_permlink
          })
        }

        resultsArray = resultsArray.sort((a,b) => {
            return b.id - a.id
        });

        // console.log(resultsArray)
        // console.log(resultsArray.pop())
        // console.log(resultsArray)


        resultsArray.forEach( (post, i, arr) => {
            var permlink = post.parent_permlink
            var  template = `
            <div data-post-id="${post.id}"  class="comment-level-${post.depth} ${post.permlink}">
            <h4>${post.id}</h4>
            <h3><a href="">${post.title}</a> - ${post.author}</h3>
            <p>${ (post.body).substring(0, 250) }...</p>
            </div>`
            //
            if ( post.depth === 1 ) {
              $('body').prepend( template)
            } else {
              //  console.log(  selector
              // $('body').prepend( template)
              // $('body').find(selector).css('background', 'red')
              $('.' + permlink ).prepend( template)
              console.log(permlink)
              console.log( $('.' + permlink ))
            }
        })

        resultsArray.forEach( (post, i, arr) => {
            var permlink = post.parent_permlink
            var  template = `
            <div data-post-id="${post.id}" class="comment-level-${post.depth} ${post.permlink}">
            <h4>${post.id}</h4>
            <h3><a href="">${post.title}</a> - ${post.author}</h3>
            <p>${ (post.body).substring(0, 250) }...</p>
            </div>`
            //
            if ( post.depth > 1 ) {

              $('.' + permlink ).prepend( template)
              console.log(permlink)
              console.log( $('.' + permlink ))
            }
        })



    });
    </script>
  </body>
</html>
