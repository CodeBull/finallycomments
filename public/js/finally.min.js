!function(W){"use strict";function X(Oa,Pa,Qa){"addEventListener"in window?Oa.addEventListener(Pa,Qa,!1):"attachEvent"in window&&Oa.attachEvent("on"+Pa,Qa)}function Y(Oa,Pa,Qa){"removeEventListener"in window?Oa.removeEventListener(Pa,Qa,!1):"detachEvent"in window&&Oa.detachEvent("on"+Pa,Qa)}function Z(){var Oa,Pa=["moz","webkit","o","ms"];for(Oa=0;Oa<Pa.length&&!Ia;Oa+=1)Ia=window[Pa[Oa]+"RequestAnimationFrame"];Ia||ca("setup","RequestAnimationFrame not supported")}function _(Oa){var Pa="Host page: "+Oa;return window.top!==window.self&&(Pa=window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+Oa:"Nested host page: "+Oa),Pa}function aa(Oa){return Fa+"["+_(Oa)+"]"}function ba(Oa){return Ka[Oa]?Ka[Oa].log:Ba}function ca(Oa,Pa){fa("log",Oa,Pa,ba(Oa))}function da(Oa,Pa){fa("info",Oa,Pa,ba(Oa))}function ea(Oa,Pa){fa("warn",Oa,Pa,!0)}function fa(Oa,Pa,Qa,Ra){!0===Ra&&"object"==typeof window.console&&console[Oa](aa(Pa),Qa)}function ga(Oa){function Pa(){Ra("Height"),Ra("Width"),oa(function(){na(kb),ka(lb),eb("resizedCallback",kb)},kb,"init")}function Ra(mb){var nb=+Ka[lb]["max"+mb],ob=+Ka[lb]["min"+mb],pb=mb.toLowerCase(),qb=+kb[pb];ca(lb,"Checking "+pb+" is in range "+ob+"-"+nb),ob>qb&&(qb=ob,ca(lb,"Set "+pb+" to min value")),qb>nb&&(qb=nb,ca(lb,"Set "+pb+" to max value")),kb[pb]=""+qb}function Va(mb){return jb.substr(jb.indexOf(":")+Ea+mb)}function Wa(mb){ca(lb,"MessageCallback passed: {iframe: "+kb.iframe.id+", message: "+mb+"}"),eb("messageCallback",{iframe:kb.iframe,message:JSON.parse(mb)}),ca(lb,"--")}function Xa(){var mb=document.body.getBoundingClientRect(),nb=kb.iframe.getBoundingClientRect();return JSON.stringify({iframeHeight:nb.height,iframeWidth:nb.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(nb.top-mb.top,10),offsetLeft:parseInt(nb.left-mb.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset})}function Ya(mb,nb){sa(function(){pa("Send Page Info","pageInfo:"+Xa(),mb,nb)},32)}function Za(){function mb(qb,rb){function sb(){Ka[pb]?Ya(Ka[pb].iframe,pb):nb()}["scroll","resize"].forEach(function(tb){ca(pb,qb+tb+" listener for sendPageInfo"),rb(window,tb,sb)})}function nb(){mb("Remove ",Y)}var pb=lb;(function(){mb("Add ",X)})(),Ka[pb]&&(Ka[pb].stopPageInfo=nb)}function $a(){Ka[lb]&&Ka[lb].stopPageInfo&&(Ka[lb].stopPageInfo(),delete Ka[lb].stopPageInfo)}function ab(mb){var nb=mb.getBoundingClientRect();return ja(lb),{x:Math.floor(+nb.left+ +Ha.x),y:Math.floor(+nb.top+ +Ha.y)}}function bb(mb){var qb=mb?ab(kb.iframe):{x:0,y:0},rb=function(){return{x:+kb.width+qb.x,y:+kb.height+qb.y}}();ca(lb,"Reposition requested from iFrame (offset x:"+qb.x+" y:"+qb.y+")"),window.top===window.self?function(){Ha=rb,cb(),ca(lb,"--")}():function(){window.parentIFrame?window.parentIFrame["scrollTo"+(mb?"Offset":"")](rb.x,rb.y):ea(lb,"Unable to scroll to requested position, window.parentIFrame not found")}()}function cb(){!1===eb("scrollCallback",Ha)?la():ka(lb)}function db(mb){var pb=mb.split("#")[1]||"",qb=decodeURIComponent(pb),rb=document.getElementById(qb)||document.getElementsByName(qb)[0];rb?function(){var sb=ab(rb);ca(lb,"Moving to in page link (#"+pb+") at x: "+sb.x+" y: "+sb.y),Ha={x:sb.x,y:sb.y},cb(),ca(lb,"--")}():window.top===window.self?ca(lb,"In page link #"+pb+" not found"):function(){window.parentIFrame?window.parentIFrame.moveToAnchor(pb):ca(lb,"In page link #"+pb+" not found and window.parentIFrame not found")}()}function eb(mb,nb){return ha(lb,mb,nb)}function ib(){Ka[lb]&&(Ka[lb].firstRun=!1)}var jb=Oa.data,kb={},lb=null;"[iFrameResizerChild]Ready"===jb?function(){for(var mb in Ka)pa("iFrame requested init",qa(mb),document.getElementById(mb),mb)}():function(){return Fa===(""+jb).substr(0,Ga)&&jb.substr(Ga).split(":")[0]in Ka}()?(kb=function(){var mb=jb.substr(Ga).split(":");return{iframe:Ka[mb[0]]&&Ka[mb[0]].iframe,id:mb[0],height:mb[1],width:mb[2],type:mb[3]}}(),lb=Ma=kb.id,Ka[lb]&&(Ka[lb].loaded=!0),!function(){var mb=kb.type in{"true":1,"false":1,undefined:1};return mb&&ca(lb,"Ignoring init message from meta parent page"),mb}()&&function(mb){var nb=!0;return Ka[mb]||(nb=!1,ea(kb.type+" No settings for "+mb+". Message was: "+jb)),nb}(lb)&&(ca(lb,"Received: "+jb),function(){var mb=!0;return null===kb.iframe&&(ea(lb,"IFrame ("+kb.id+") not found"),mb=!1),mb}()&&function(){var nb=Oa.origin,ob=Ka[lb]&&Ka[lb].checkOrigin;if(ob&&"null"!=""+nb&&!function(){return ob.constructor===Array?function(){var rb=0,sb=!1;for(ca(lb,"Checking connection is from allowed list of origins: "+ob);rb<ob.length;rb++)if(ob[rb]===nb){sb=!0;break}return sb}():function(){var rb=Ka[lb]&&Ka[lb].remoteHost;return ca(lb,"Checking connection is from: "+rb),nb===rb}()}())throw new Error("Unexpected message received from: "+nb+" for "+kb.iframe.id+". Message was: "+Oa.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}()&&function(){switch(Ka[lb]&&Ka[lb].firstRun&&ib(),kb.type){case"close":Ka[lb].closeRequestCallback?ha(lb,"closeRequestCallback",Ka[lb].iframe):ia(kb.iframe);break;case"message":Wa(Va(6));break;case"scrollTo":bb(!1);break;case"scrollToOffset":bb(!0);break;case"pageInfo":Ya(Ka[lb]&&Ka[lb].iframe,lb),Za();break;case"pageInfoStop":$a();break;case"inPageLink":db(Va(9));break;case"reset":ma(kb);break;case"init":Pa(),eb("initCallback",kb.iframe);break;default:Pa();}}())):da(lb,"Ignored: "+jb)}function ha(Oa,Pa,Qa){var Ra=null,Sa=null;if(Ka[Oa]){if(Ra=Ka[Oa][Pa],"function"!=typeof Ra)throw new TypeError(Pa+" on iFrame["+Oa+"] is not a function");Sa=Ra(Qa)}return Sa}function ia(Oa){var Pa=Oa.id;ca(Pa,"Removing iFrame: "+Pa),Oa.parentNode&&Oa.parentNode.removeChild(Oa),ha(Pa,"closedCallback",Pa),ca(Pa,"--"),delete Ka[Pa]}function ja(Oa){null===Ha&&(Ha={x:window.pageXOffset===W?document.documentElement.scrollLeft:window.pageXOffset,y:window.pageYOffset===W?document.documentElement.scrollTop:window.pageYOffset},ca(Oa,"Get page position: "+Ha.x+","+Ha.y))}function ka(Oa){null!==Ha&&(window.scrollTo(Ha.x,Ha.y),ca(Oa,"Set page position: "+Ha.x+","+Ha.y),la())}function la(){Ha=null}function ma(Oa){ca(Oa.id,"Size reset requested by "+("init"===Oa.type?"host page":"iFrame")),ja(Oa.id),oa(function(){na(Oa),pa("reset","reset",Oa.iframe,Oa.id)},Oa,"reset")}function na(Oa){function Pa(Ta){Oa.iframe.style[Ta]=Oa[Ta]+"px",ca(Oa.id,"IFrame ("+Sa+") "+Ta+" set to "+Oa[Ta]+"px")}function Qa(Ta){Ca||"0"!==Oa[Ta]||(Ca=!0,ca(Sa,"Hidden iFrame detected, creating visibility listener"),ta())}function Ra(Ta){Pa(Ta),Qa(Ta)}var Sa=Oa.iframe.id;Ka[Sa]&&(Ka[Sa].sizeHeight&&Ra("height"),Ka[Sa].sizeWidth&&Ra("width"))}function oa(Oa,Pa,Qa){Qa!==Pa.type&&Ia?(ca(Pa.id,"Requesting animation frame"),Ia(Oa)):Oa()}function pa(Oa,Pa,Qa,Ra,Sa){function Ta(){var Ya=Ka[Ra]&&Ka[Ra].targetOrigin;ca(Ra,"["+Oa+"] Sending msg to iframe["+Ra+"] ("+Pa+") targetOrigin: "+Ya),Qa.contentWindow.postMessage(Fa+Pa,Ya)}function Ua(){ea(Ra,"["+Oa+"] IFrame("+Ra+") not found")}var Xa=!1;Ra=Ra||Qa.id,Ka[Ra]&&(function(){Qa&&"contentWindow"in Qa&&null!==Qa.contentWindow?Ta():Ua()}(),function(){Sa&&Ka[Ra]&&Ka[Ra].warningTimeout&&(Ka[Ra].msgTimeout=setTimeout(function(){!Ka[Ra]||Ka[Ra].loaded||Xa||(Xa=!0,ea(Ra,"IFrame has not responded within "+Ka[Ra].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ingored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))},Ka[Ra].warningTimeout))}())}function qa(Oa){return Oa+":"+Ka[Oa].bodyMarginV1+":"+Ka[Oa].sizeWidth+":"+Ka[Oa].log+":"+Ka[Oa].interval+":"+Ka[Oa].enablePublicMethods+":"+Ka[Oa].autoResize+":"+Ka[Oa].bodyMargin+":"+Ka[Oa].heightCalculationMethod+":"+Ka[Oa].bodyBackground+":"+Ka[Oa].bodyPadding+":"+Ka[Oa].tolerance+":"+Ka[Oa].inPageLinks+":"+Ka[Oa].resizeFrom+":"+Ka[Oa].widthCalculationMethod}function ra(Oa,Pa){function Ra(){var cb=Pa&&Pa.id||Na.id+Aa++;return null!==document.getElementById(cb)&&(cb+=Aa++),cb}function Va(){var cb=Ka[bb]&&Ka[bb].firstRun,db=Ka[bb]&&Ka[bb].heightCalculationMethod in Ja;!cb&&db&&ma({iframe:Oa,height:0,width:0,type:"init"})}function Ya(cb){if("object"!=typeof cb)throw new TypeError("Options is not an object")}function Za(cb){for(var db in Na)Na.hasOwnProperty(db)&&(Ka[bb][db]=cb.hasOwnProperty(db)?cb[db]:Na[db])}function $a(cb){return""===cb||"file://"===cb?"*":cb}var bb=function(cb){return Ma=cb,""===cb&&(Oa.id=cb=Ra(),Ba=(Pa||{}).log,Ma=cb,ca(cb,"Added missing iframe ID: "+cb+" ("+Oa.src+")")),cb}(Oa.id);(function(){return bb in Ka&&"iFrameResizer"in Oa})()?ea(bb,"Ignored iFrame, already setup."):(function(cb){cb=cb||{},Ka[bb]={firstRun:!0,iframe:Oa,remoteHost:Oa.src.split("/").slice(0,3).join("/")},Ya(cb),Za(cb),Ka[bb]&&(Ka[bb].targetOrigin=!0===Ka[bb].checkOrigin?$a(Ka[bb].remoteHost):"*")}(Pa),function(){switch(ca(bb,"IFrame scrolling "+(Ka[bb]&&Ka[bb].scrolling?"enabled":"disabled")+" for "+bb),Oa.style.overflow=!1===(Ka[bb]&&Ka[bb].scrolling)?"hidden":"auto",Ka[bb]&&Ka[bb].scrolling){case!0:Oa.scrolling="yes";break;case!1:Oa.scrolling="no";break;default:Oa.scrolling=Ka[bb]?Ka[bb].scrolling:"no";}}(),function(){function cb(eb){1/0!==Ka[bb][eb]&&0!==Ka[bb][eb]&&(Oa.style[eb]=Ka[bb][eb]+"px",ca(bb,"Set "+eb+" = "+Ka[bb][eb]+"px"))}function db(eb){if(Ka[bb]["min"+eb]>Ka[bb]["max"+eb])throw new Error("Value for min"+eb+" can not be greater than max"+eb)}db("Height"),db("Width"),cb("maxHeight"),cb("minHeight"),cb("maxWidth"),cb("minWidth")}(),function(){("number"==typeof(Ka[bb]&&Ka[bb].bodyMargin)||"0"===(Ka[bb]&&Ka[bb].bodyMargin))&&(Ka[bb].bodyMarginV1=Ka[bb].bodyMargin,Ka[bb].bodyMargin=""+Ka[bb].bodyMargin+"px")}(),function(cb){X(Oa,"load",function(){pa("iFrame.onload",cb,Oa,W,!0),Va()}),pa("init",cb,Oa,W,!0)}(qa(bb)),function(){Function.prototype.bind&&Ka[bb]&&(Ka[bb].iframe.iFrameResizer={close:ia.bind(null,Ka[bb].iframe),resize:pa.bind(null,"Window resize","resize",Ka[bb].iframe),moveToAnchor:function(cb){pa("Move to anchor","moveToAnchor:"+cb,Ka[bb].iframe,bb)},sendMessage:function(cb){cb=JSON.stringify(cb),pa("Send Message","message:"+cb,Ka[bb].iframe,bb)}})}())}function sa(Oa,Pa){null===La&&(La=setTimeout(function(){La=null,Oa()},Pa))}function ta(){function Oa(){function Sa(Ua){function Va(Xa){return"0px"===(Ka[Ua]&&Ka[Ua].iframe.style[Xa])}Ka[Ua]&&function(Xa){return null!==Xa.offsetParent}(Ka[Ua].iframe)&&(Va("height")||Va("width"))&&pa("Visibility change","resize",Ka[Ua].iframe,Ua)}for(var Ta in Ka)Sa(Ta)}function Pa(Sa){ca("window","Mutation observed: "+Sa[0].target+" "+Sa[0].type),sa(Oa,16)}var Ra=window.MutationObserver||window.WebKitMutationObserver;Ra&&function(){var Sa=document.querySelector("body"),Ua=new Ra(Pa);Ua.observe(Sa,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})}()}function ua(Oa){ca("window","Trigger event: "+Oa),sa(function(){wa("Window "+Oa,"resize")},16)}function va(){"hidden"!==document.visibilityState&&(ca("document","Trigger event: Visiblity change"),sa(function(){wa("Tab Visable","resize")},16))}function wa(Oa,Pa){function Qa(Sa){return Ka[Sa]&&"parent"===Ka[Sa].resizeFrom&&Ka[Sa].autoResize&&!Ka[Sa].firstRun}for(var Ra in Ka)Qa(Ra)&&pa(Oa,Pa,document.getElementById(Ra),Ra)}function xa(){X(window,"message",ga),X(window,"resize",function(){ua("resize")}),X(document,"visibilitychange",va),X(document,"-webkit-visibilitychange",va),X(window,"focusin",function(){ua("focus")}),X(window,"focus",function(){ua("focus")})}function ya(){function Oa(Ra,Sa){Sa&&(function(){if(!Sa.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==Sa.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+Sa.tagName+">")}(),ra(Sa,Ra),Qa.push(Sa))}function Pa(Ra){Ra&&Ra.enablePublicMethods&&ea("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}var Qa;return Z(),xa(),function(Ra,Sa){switch(Qa=[],Pa(Ra),typeof Sa){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(Sa||"iframe"),Oa.bind(W,Ra));break;case"object":Oa(Ra,Sa);break;default:throw new TypeError("Unexpected data type ("+typeof Sa+")");}return Qa}}function za(Oa){Oa.fn?Oa.fn.iFrameResize||(Oa.fn.iFrameResize=function(Pa){return this.filter("iframe").each(function(Ra,Sa){ra(Sa,Pa)}).end()}):da("","Unable to bind to jQuery, it is not fully loaded.")}if("undefined"!=typeof window){var Aa=0,Ba=!1,Ca=!1,Ea="message".length,Fa="[iFrameSizer]",Ga=Fa.length,Ha=null,Ia=window.requestAnimationFrame,Ja={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},Ka={},La=null,Ma="Host Page",Na={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){ea("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}};window.jQuery&&za(window.jQuery),"function"==typeof define&&define.amd?define([],ya):"object"==typeof module&&"object"==typeof module.exports?module.exports=ya():window.iFrameResize=window.iFrameResize||ya()}}();let finallyCommentsSystem={init:()=>{finallyCommentsSystem.setupIframe(),iFrameResize({},".finally-comments iframe")},getPartsFromLink:W=>{let X=W.substr(W.length-1);"/"===X&&(W=W.slice(0,-1));let Y=W.split("/");return{permlink:Y.pop(),author:Y.pop(),category:Y.pop()}},setupIframe:()=>{let W=document.querySelector(".finally-comments"),X=W.dataset.id,Y=finallyCommentsSystem.getPartsFromLink(X),Z=`https://finallycomments.com/thread/${Y.category}/${Y.author}/${Y.permlink}`,_=document.createElement("iframe",{scrolling:"no"});_.src=Z,_.width="100%",_.style="border: none;",W.appendChild(_),_.classList.add("finally-frame");let aa={message:"finally-frame-load",reputation:W.dataset.reputation,profile:W.dataset.profile,values:W.dataset.values};_.onload=()=>{document.querySelector(".finally-frame").contentWindow.postMessage(aa,"*")}}};finallyCommentsSystem.init(),window.addEventListener("message",receiveMessage,!1);function receiveMessage(W){if("sign-in"==W.data.message){if("https://finallycomments.com"!==W.origin)return;$(".finally-comments iframe").css("height",600)}if("new-comment"==W.data.message){if("https://finallycomments.com"!==W.origin)return;let X=getDistanceFromTop(document.querySelector(".finally-comments")),Y=document.querySelector(".finally-comments").getBoundingClientRect().height;document.documentElement.scrollTop=void 0===W.data.depth||0===W.data.depth?X+Y:W.data.offset+X-300}}function getDistanceFromTop(W){for(var X=0;W;)X+=W.offsetTop,W=W.offsetParent;return X}
